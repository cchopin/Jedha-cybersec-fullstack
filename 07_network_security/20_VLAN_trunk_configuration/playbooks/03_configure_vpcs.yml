---
# =============================================================================
# Lab 20: VLAN and Trunk Configuration
# Playbook 03: Configuration des VPCs
# =============================================================================
# Ce playbook configure les IPs sur chaque VPC
# =============================================================================

- name: Configurer les VPCs
  hosts: localhost
  gather_facts: false

  vars_files:
    - ../switch_info.yml

  tasks:
    # =========================================================================
    # Configuration des VPCs via console
    # =========================================================================
    - name: "Configurer PC_Admin_1"
      script: ../scripts/cisco_cli.py --host {{ gns3_host }} --port {{ pc_admin_1_console_port }} --commands "ip 192.168.10.10 255.255.255.0;save"
      ignore_errors: true

    - name: "Configurer PC_Admin_2"
      script: ../scripts/cisco_cli.py --host {{ gns3_host }} --port {{ pc_admin_2_console_port }} --commands "ip 192.168.10.20 255.255.255.0;save"
      ignore_errors: true

    - name: "Configurer PC_HR_1"
      script: ../scripts/cisco_cli.py --host {{ gns3_host }} --port {{ pc_hr_1_console_port }} --commands "ip 192.168.20.10 255.255.255.0;save"
      ignore_errors: true

    - name: "Configurer PC_HR_2"
      script: ../scripts/cisco_cli.py --host {{ gns3_host }} --port {{ pc_hr_2_console_port }} --commands "ip 192.168.20.20 255.255.255.0;save"
      ignore_errors: true

    - name: "Configurer PC_Sales_2"
      script: ../scripts/cisco_cli.py --host {{ gns3_host }} --port {{ pc_sales_2_console_port }} --commands "ip 192.168.30.20 255.255.255.0;save"
      ignore_errors: true

    - name: "Configurer PC_Sales_3"
      script: ../scripts/cisco_cli.py --host {{ gns3_host }} --port {{ pc_sales_3_console_port }} --commands "ip 192.168.30.30 255.255.255.0;save"
      ignore_errors: true

    - name: "Configurer PC_IT_1"
      script: ../scripts/cisco_cli.py --host {{ gns3_host }} --port {{ pc_it_1_console_port }} --commands "ip 192.168.40.10 255.255.255.0;save"
      ignore_errors: true

    - name: "Configurer PC_IT_2"
      script: ../scripts/cisco_cli.py --host {{ gns3_host }} --port {{ pc_it_2_console_port }} --commands "ip 192.168.40.20 255.255.255.0;save"
      ignore_errors: true

    - name: "Configurer PC_Guests_1"
      script: ../scripts/cisco_cli.py --host {{ gns3_host }} --port {{ pc_guests_1_console_port }} --commands "ip 192.168.50.10 255.255.255.0;save"
      ignore_errors: true

    - name: "Configurer PC_Guests_2"
      script: ../scripts/cisco_cli.py --host {{ gns3_host }} --port {{ pc_guests_2_console_port }} --commands "ip 192.168.50.20 255.255.255.0;save"
      ignore_errors: true

    # =========================================================================
    # Resume
    # =========================================================================
    - name: Resume
      debug:
        msg: |
          ========================================
          VPCs CONFIGURES
          ========================================

          VLAN 10 - Administration:
            PC_Admin_1: 192.168.10.10
            PC_Admin_2: 192.168.10.20

          VLAN 20 - HR:
            PC_HR_1: 192.168.20.10
            PC_HR_2: 192.168.20.20

          VLAN 30 - Sales:
            PC_Sales_2: 192.168.30.20
            PC_Sales_3: 192.168.30.30

          VLAN 40 - IT:
            PC_IT_1: 192.168.40.10
            PC_IT_2: 192.168.40.20

          VLAN 50 - Guests:
            PC_Guests_1: 192.168.50.10
            PC_Guests_2: 192.168.50.20

          ========================================
          TESTS DE CONNECTIVITE
          ========================================

          Ces pings doivent FONCTIONNER (meme VLAN):
            PC_Admin_1 -> PC_Admin_2: ping 192.168.10.20
            PC_HR_1 -> PC_HR_2: ping 192.168.20.20
            PC_IT_1 -> PC_IT_2: ping 192.168.40.20
            PC_Guests_1 -> PC_Guests_2: ping 192.168.50.20

          Ces pings NE doivent PAS fonctionner (VLANs differents):
            PC_Admin_1 -> PC_HR_1: ping 192.168.20.10

          ========================================
